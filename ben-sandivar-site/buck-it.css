/* ============== Theme ============== */
:root{
  --bg-0:#020409;
  --bg-grad:radial-gradient(1200px 1200px at 20% 120%,#0a0d12 0,#04070e 55%,#000 100%);
  --glass:rgba(20,22,28,.38);
  --glass-strong:rgba(20,22,28,.55);
  --glass-brd:rgba(255,255,255,.22);
  --text:#eef3ff;
  --muted:#b9c6d9;
  --accent:#8fd3ff;
  --accent-2:#56a4ff;
  --danger:#ff6b6b;
  --shadow:0 24px 60px rgba(0,0,0,.55);
  --inner:inset 0 1px 0 rgba(255,255,255,.08);
  --pill:rgba(255,255,255,.10);
  --pill-hover:rgba(255,255,255,.16);
}

/* Page + canvas (support old #canvas and new #view) */
html,body{height:100%;margin:0;overflow:hidden;background:var(--bg-grad);color:var(--text)}
#canvas,#view{display:block;width:100vw;height:100vh}

/* Hint */
#hint{position:fixed;top:12px;left:50%;transform:translateX(-50%);font:13px/1.25 system-ui;opacity:.7;user-select:none}

/* ============== Toolbar (support #toolbar and #bar) ============== */
#toolbar,#bar{
  position:fixed;left:16px;bottom:16px;
  display:flex;gap:10px;align-items:center;
  z-index:20;opacity:.05;transition:opacity .18s ease;
}
#toolbar:hover,#toolbar:focus-within,#bar:hover,#bar:focus-within,#bar.show{opacity:1}

/* Buttons (support .tool-btn and .btn) */
.tool-btn,.btn{
  min-width:40px;height:40px;padding:0 12px;
  display:flex;align-items:center;justify-content:center;gap:8px;
  border-radius:12px;border:1px solid var(--glass-brd);
  background:var(--pill);color:#fff;cursor:pointer;
  backdrop-filter:blur(12px) saturate(1.25);
  box-shadow:var(--shadow),var(--inner);
  user-select:none;-webkit-user-select:none;
  transition:background .12s,transform .06s,box-shadow .12s;
}
.btn{padding:12px 16px;border-radius:14px} /* for label buttons */
.tool-btn:hover,.btn:hover{background:var(--pill-hover)}
.tool-btn:active,.btn:active{transform:translateY(1px)}
.tool-btn.active,.btn.active{outline:1px solid var(--accent);box-shadow:0 0 0 3px rgba(143,211,255,.16),var(--shadow),var(--inner)}
.tool-btn:focus-visible,.btn:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
.iconbtn{width:38px;height:38px;border-radius:12px;display:grid;place-items:center}
.tool-btn>*,.btn>*{pointer-events:none}
.btn .label{font:13px/1.2 system-ui,Segoe UI,Roboto,sans-serif;letter-spacing:.2px}

/* Swatch circle */
#swatch{width:18px;height:18px;border-radius:50%;border:2px solid #fff8;box-shadow:0 0 0 2px #0003 inset}

/* ============== Glass Menus / Popovers ============== */
.menu{
  position:fixed;inset:auto auto 72px 16px;min-width:260px;padding:10px;
  display:none;z-index:30;color:var(--text);
  background:var(--glass);border:1px solid var(--glass-brd);
  border-radius:14px;backdrop-filter:blur(12px) saturate(1.2);
  box-shadow:var(--shadow),var(--inner);
}
.menu.show{display:block;animation:menu-pop .12s ease-out}
@keyframes menu-pop{from{transform:translateY(6px);opacity:0}to{transform:none;opacity:1}}

.menu .menu-item{
  display:flex;align-items:center;gap:10px;
  padding:8px 10px;border-radius:10px;cursor:pointer;font:13px/1.25 system-ui,Segoe UI,Roboto,sans-serif;
}
.menu .menu-item:hover{background:rgba(255,255,255,.14)}
.menu .menu-item.active{background:rgba(143,211,255,.20);outline:1px solid rgba(143,211,255,.35)}
.menu .dot{width:8px;height:8px;border-radius:50%;background:currentColor;opacity:.9}

/* Rows + form controls inside menus */
.row{display:flex;align-items:center;gap:10px;padding:6px 8px}
.row label{width:92px;font:12px/1.1 system-ui,Segoe UI,Roboto,sans-serif;color:var(--muted)}

/* High-contrast selects and inputs (fix white-on-white) */
.menu select,
.menu input[type="number"],
.menu input[type="text"]{
  appearance:none;-webkit-appearance:none;
  width:100%;padding:8px 12px;border-radius:10px;
  background:linear-gradient(180deg,#0c1118,#0a0f16);color:#fff;
  border:1px solid var(--glass-brd);
}
.menu select:focus,
.menu input[type="number"]:focus,
.menu input[type="text"]:focus{outline:1.5px solid var(--accent)}

/* Action buttons */
.actions{display:flex;justify-content:flex-end;gap:8px;padding:8px}
.btn-ghost{background:transparent;border:1px solid var(--glass-brd);color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer}
.btn-primary{background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#00121f;border:0;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600}
.btn-ghost:hover{background:rgba(255,255,255,.08)}
.btn-primary:hover{filter:brightness(1.05)}

/* ============== New menu ============== */
#newMenu h4{margin:6px 8px 4px;font:12px/1.1 ui-monospace,Menlo,monospace;color:var(--muted);letter-spacing:.3px}
.colors{display:grid;grid-template-columns:repeat(7,28px);gap:10px;padding:6px 8px}
.cwell{
  width:28px;height:28px;border-radius:50%;
  border:2px solid #fffa;box-shadow:0 0 0 2px #0003 inset;cursor:pointer;position:relative;background:#1aa4ff;
}
.cwell input{position:absolute;inset:0;opacity:0} /* click-through */
.cwell:focus-visible{outline:2px solid var(--accent)}

/* ============== Export ============== */
#exportMenu .grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:6px}
#exportMenu .full{grid-column:1/-1}
#exportMenu .small{font:12px/1 ui-monospace,Menlo,monospace;color:var(--muted)}

/* ============== Settings (support old and new IDs) ============== */
#overlay{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;z-index:35}
#overlay.show{display:block}

#settingsPanel,#panel{
  position:fixed;top:96px;left:96px;width:360px;padding:10px 12px;z-index:40;display:none;
  background:var(--glass);border:1px solid var(--glass-brd);
  border-radius:18px;backdrop-filter:blur(14px) saturate(1.35);
  box-shadow:var(--shadow),var(--inner)
}
#settingsPanel.show,#panel.show{display:block;animation:menu-pop .14s ease-out}

#settingsDrag,#drag{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:8px 6px 10px;cursor:grab}
#settingsDrag:active,#drag:active{cursor:grabbing}
#settingsTitle,#title{font:12px/1.1 ui-monospace,Menlo,monospace;color:var(--muted);letter-spacing:.3px}
#settingsClose,#close{
  width:26px;height:26px;border-radius:8px;border:1px solid var(--glass-brd);
  background:rgba(255,255,255,.10);color:#fff;display:grid;place-items:center;cursor:pointer
}
#settingsClose:hover,#close:hover{background:rgba(255,255,255,.16)}

#settingsGrid,#grid{display:grid;grid-template-columns:1fr auto;gap:8px 10px;padding:6px 4px 4px}
#settingsGrid label,#grid label{font:12px/1.1 system-ui;color:var(--muted)}
#settingsGrid .val,#grid .val{width:48px;text-align:right;font:12px/1 ui-monospace,Menlo;color:#d7e3f9}
#grid input[type="range"]{width:220px}

/* Sliders */
input[type="range"]{
  -webkit-appearance:none;appearance:none;height:4px;background:linear-gradient(90deg,#0e1420,#0b111c);
  border-radius:999px;outline:none;border:1px solid rgba(255,255,255,.08)
}
input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance:none;appearance:none;width:16px;height:16px;border-radius:50%;
  background:linear-gradient(180deg,#fff,#bcdcff);border:1px solid rgba(0,0,0,.25);box-shadow:0 2px 6px rgba(0,0,0,.4)
}
input[type="range"]::-moz-range-thumb{width:16px;height:16px;border-radius:50%;background:#fff;border:1px solid rgba(0,0,0,.25)}

/* ============== Tips ============== */
#tips{position:fixed;left:0;right:0;bottom:84px;display:flex;justify-content:center;pointer-events:none;z-index:35}
.tip{
  background:var(--glass);border:1px solid var(--glass-brd);border-radius:14px;padding:10px 12px;color:#fff;
  font:13px/1.25 system-ui;max-width:min(70vw,520px);box-shadow:var(--shadow);backdrop-filter:blur(12px) saturate(1.2);
  opacity:0;transform:translateY(6px);transition:opacity .2s,transform .2s
}
.tip.show{opacity:1;transform:none}

/* ============== Color Wheel Popover (support both APIs) ============== */
#wheelPopover,.color-pop{position:fixed;inset:auto auto 72px 16px;display:none;z-index:60}
#wheelPopover.show,.color-pop.show{display:block;animation:menu-pop .12s ease-out}
.wheel-card,.wheel-wrap{
  background:var(--glass);border:1px solid var(--glass-brd);border-radius:14px;padding:12px;
  backdrop-filter:blur(12px) saturate(1.2);box-shadow:var(--shadow);display:flex;flex-direction:column;align-items:center;gap:10px
}
/* current IDs */
#wheel{width:220px;height:220px;display:block}
#diamond{width:160px;height:160px;display:block}
#hex{
  width:120px;text-align:center;border-radius:10px;border:1px solid var(--glass-brd);
  background:#0c1018;color:#fff;padding:6px 8px;font:13px/1.2 ui-monospace,Menlo,monospace
}
/* legacy IDs */
#colorWheel{width:220px;height:220px;display:block}
#svDiamond{width:160px;height:160px;display:block}
#hexField{
  width:120px;text-align:center;border-radius:10px;border:1px solid var(--glass-brd);
  background:#0c1018;color:#fff;padding:6px 8px;font:13px/1.2 ui-monospace,Menlo,monospace
}

/* ============== Welcome card (optional) ============== */
#welcome{
  position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);
  max-width:min(560px,90vw);padding:16px 18px;z-index:25;
  background:var(--glass);border:1px solid var(--glass-brd);border-radius:16px;box-shadow:var(--shadow),var(--inner)
}
#welcome.hidden{display:none}
#welcome h2{margin:4px 0 10px;font:600 18px/1.2 system-ui,Segoe UI,Roboto,sans-serif;letter-spacing:.2px}
#welcome p{margin:0 0 12px;font:14px/1.45 system-ui,Segoe UI,Roboto,sans-serif;color:#dfe8f6}
#welcome button{border:0;border-radius:12px;padding:10px 14px;cursor:pointer;background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#00121f;font-weight:600}

/* Tooltips (hover labels) */
.tooltip{
  position:fixed;padding:6px 9px;border-radius:10px;background:var(--glass-strong);border:1px solid var(--glass-brd);
  color:#fff;font:12px/1.2 system-ui;backdrop-filter:blur(10px);box-shadow:var(--shadow);pointer-events:none;opacity:0;transform:translateY(4px);transition:opacity .12s,transform .12s
}
.tooltip.show{opacity:1;transform:none}

/* ============== Responsive tweaks ============== */
@media (max-width:720px){
  #toolbar,#bar{left:8px;bottom:8px}
  .menu{min-width:240px;inset:auto auto 64px 8px}
  .btn{padding:10px 12px}
  .iconbtn{width:36px;height:36px}
}

/* Accessibility */
:focus-visible{outline:2px solid var(--accent);outline-offset:3px}
