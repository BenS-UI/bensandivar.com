<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bucket – Fluid Art Game</title>
<link rel="icon" type="image/png" href="assets/favicon.png">
<link rel="shortcut icon" href="assets/favicon.png" type="image/png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Gabarito:wght@400;700;900&family=Geologica:wght@300;400;500;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined" rel="stylesheet">
<link rel="stylesheet" href="buck-it.css">
<script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5.5.3/dist/iro.min.js"></script>
<style>
/* Additional styling for fluid art page */
body {
  margin:0;
  padding:0;
  overflow:hidden;
  background:#020c1f; /* dark background reminiscent of reference image */
  color:#fff;
}
#toolbar {
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:8px;
  align-items:center;
  padding:8px 12px;
  background:rgba(255,255,255,0.15);
  backdrop-filter:blur(10px);
  border-radius:14px;
  border:1px solid rgba(255,255,255,0.3);
  opacity:0.05;
  transition:opacity 0.3s;
}
@@ -56,55 +57,62 @@ body {
.tool-btn.active {
  background:rgba(255,255,255,0.4);
}
.tool-group {
  display:flex;
  gap:4px;
}
/* Colour selector ring: a conic gradient ring with a swatch inside */
#colorSelector {
  width:44px;
  height:44px;
  border-radius:50%;
  position:relative;
  overflow:hidden;
  cursor:pointer;
  padding:4px; /* space for ring */
  background:conic-gradient(red, yellow, lime, cyan, blue, magenta, red);
}
#colorSelector .swatch {
  position:absolute;
  inset:4px;
  border-radius:50%;
  background:#00aaff;
  box-shadow:0 0 0 2px rgba(255,255,255,0.5);
}
#colorPickerPopup {
  position:fixed;
  bottom:80px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(255,255,255,0.15);
  backdrop-filter:blur(10px);
  border:1px solid rgba(255,255,255,0.3);
  border-radius:16px;
  padding:10px;
  display:none;
  z-index:101;
}
#settingsPanel, #newPanel, #exportPanel {
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  min-width:280px;
  background:rgba(255,255,255,0.15);
  backdrop-filter:blur(10px);
  border-radius:16px;
  border:1px solid rgba(255,255,255,0.3);
  padding:16px;
  color:#fff;
  z-index:100;
  display:none;
}
.panel-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:move;
  margin-bottom:8px;
}
.panel-header h3 {
  margin:0;
@@ -295,94 +303,96 @@ body {
</style>
</head>
<body>
<nav class="navbar">
  <div class="nav-container">
    <a href="/ben-sandivar-site/index.html" class="logo">
      <img src="https://raw.githubusercontent.com/BenS-UI/portfolio/cfc0bc646dc8f7cb21379d516f1b1ca0c0f85e06/B-logo-a.svg" alt="Ben Sandivar Logo">
    </a>
    <button class="more-btn" aria-label="Toggle Menu">
      <span class="material-symbols-outlined">menu</span>
    </button>
    <ul class="nav-links">
      <li><a href="/ben-sandivar-site/index.html#hero">Home</a></li>
      <li><a href="/ben-sandivar-site/index.html#projects">Work</a></li>
      <li><a href="/ben-sandivar-site/index.html#music">Music</a></li>
      <li><a href="/ben-sandivar-site/index.html#about">About</a></li>
      <li><a href="/ben-sandivar-site/index.html#contact">Contact</a></li>
      <li><a href="/ben-sandivar-site/blog.html">Blog</a></li>
    </ul>
  </div>
  <div id="tooltip"></div>
</nav>
<canvas id="fluid"></canvas>
<div id="toolbar">
  <div id="colorSelector">
    <div class="swatch" style="background:#00aaff"></div>
  </div>
  <div id="colorPickerPopup"></div>
  <div class="tool-dropdown" id="colorDropdown">
    <!-- Colour tool group button toggles the drop-up. Clicking anywhere on the button opens/closes the menu -->
    <button class="tool-btn group-btn" data-name="Colour Tools" data-desc="Choose a colouring tool">
      <span class="material-symbols-outlined">palette</span>
    </button>
    <div class="tool-options">
      <button class="tool-btn" data-tool="bucket" data-name="Bucket" data-desc="Hold to pour colour and gradually fill an area"><span class="material-symbols-outlined">format_color_fill</span></button>
      <button class="tool-btn" data-tool="splatter" data-name="Splatter" data-desc="Hold to throw random drops; higher speed increases spin"><span class="material-symbols-outlined">water_drop</span></button>
      <button class="tool-btn" data-tool="spray" data-name="Spray" data-desc="Hold to spray a fine mist of colour"><span class="material-symbols-outlined">sprinkler</span></button>
      <button class="tool-btn" data-tool="glitter" data-name="Glitter" data-desc="Hold to sprinkle shimmering speckles"><span class="material-symbols-outlined">auto_awesome</span></button>
    </div>
  </div>
  <div class="tool-dropdown" id="blendDropdown">
    <!-- Blending tool group button toggles the drop-up. Clicking anywhere opens/closes the menu -->
    <button class="tool-btn group-btn" data-name="Blend Tools" data-desc="Choose a blending tool">
      <span class="material-symbols-outlined">tune</span>
    </button>
    <div class="tool-options">
      <button class="tool-btn" data-tool="blender" data-name="Blender" data-desc="Hold to spin the paint; left click spins clockwise, right click anticlockwise"><span class="material-symbols-outlined">autorenew</span></button>
      <button class="tool-btn" data-tool="smudge" data-name="Smudge" data-desc="Hold and drag to smear paint like your finger"><span class="material-symbols-outlined">gesture</span></button>
      <button class="tool-btn" data-tool="push" data-name="Push" data-desc="Hold and drag to push paint away from your pointer"><span class="material-symbols-outlined">open_with</span></button>
      <button class="tool-btn" data-tool="pinch" data-name="Pinch" data-desc="Hold to pinch inward or outward depending on click"><span class="material-symbols-outlined">center_focus_strong</span></button>
      <button class="tool-btn" data-tool="ripple" data-name="Ripple" data-desc="Hold to create expanding waves in the paint"><span class="material-symbols-outlined">waves</span></button>
    </div>
  </div>
    <button class="tool-btn" id="newBtn" data-name="New Artwork" data-desc="Start a new piece with fresh colours and layout"><span class="material-symbols-outlined">fiber_new</span></button>
    <button class="tool-btn" id="undoBtn" data-name="Undo" data-desc="Undo the last change"><span class="material-symbols-outlined">undo</span></button>
    <button class="tool-btn" id="redoBtn" data-name="Redo" data-desc="Redo the undone change"><span class="material-symbols-outlined">redo</span></button>
    <button class="tool-btn" id="exportBtn" data-name="Export" data-desc="Export your artwork to an image"><span class="material-symbols-outlined">download</span></button>
    <button class="tool-btn" id="cameraBtn" data-name="Snapshot" data-desc="Quickly capture and save a snapshot"><span class="material-symbols-outlined">photo_camera</span></button>
    <button class="tool-btn" id="settingsBtn" data-name="Settings" data-desc="Adjust brush and fluid settings"><span class="material-symbols-outlined">settings</span></button>
    <!-- Removed Tutorial button: tooltips handle guidance -->
</div>
<!-- Settings panel -->
<div id="settingsPanel">
  <div class="panel-header"><h3>Settings</h3><button class="close-btn">&times;</button></div>
  <div class="panel-content">
        <label data-name="Speed" data-desc="Controls how fast the simulation evolves">Speed <input id="speed" type="range" min="0" max="4" step="0.01" value="1.5"></label>
        <label data-name="Strength" data-desc="Controls the strength of the tool effect">Strength <input id="strength" type="range" min="0" max="60" step="0.1" value="24"></label>
        <label data-name="Size" data-desc="Adjusts the radius of your tool">Size <input id="size" type="range" min="10" max="300" step="1" value="120"></label>
        <label data-name="Viscosity" data-desc="Higher values make the fluid thicker and move slower">Viscosity <input id="visc" type="range" min="0" max="0.01" step="0.0001" value="0.0008"></label>
        <label data-name="Diffusion" data-desc="Controls how quickly colours blend into the surroundings">Diffusion <input id="diff" type="range" min="0" max="0.002" step="0.0001" value="0.0005"></label>
        <label data-name="Resolution" data-desc="Adjust the simulation detail; higher is slower">Resolution <input id="resolution" type="range" min="128" max="384" step="1" value="128"></label>
  </div>
</div>
<!-- New layout panel -->
<div id="newPanel">
  <div class="panel-header"><h3>New Artwork</h3><button class="close-btn">&times;</button></div>
  <div class="panel-content">
    <label>Number of Colors
      <select id="newColors">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
      </select>
    </label>
    <label>Layout
      <select id="newLayout">
        <option value="bisection">Bisection</option>
        <option value="squares">Squares</option>
        <option value="sectors">Radial Sectors</option>
        <option value="rings">Rings</option>
        <option value="spiral">Spiral</option>
        <option value="blotches">Blotches</option>
@@ -942,67 +952,136 @@ body {
        if(dist2>r2v) continue;
        const dist = Math.sqrt(dist2)+1e-6;
        const w = 1 - dist2/r2v;
        const amp = Math.sin((dist / rG) * Math.PI * 4 - ripplePhase) * amp0 * w;
        const id = IX(i,j);
        u0[id] += (dx/dist) * amp * dt;
        v0[id] += (dy/dist) * amp * dt;
      }
    }
  }
  function clamp(v,a,b){ return v < a ? a : (v > b ? b : v); }
  function gridFromPx(px, py) {
    const x = clamp(((px / W) * (N+2)), 1, N);
    const y = clamp(((py / H) * (N+2)), 1, N);
    return [x,y];
  }
  function ensureCanvas() {
    DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    W = Math.floor(window.innerWidth * DPR);
    H = Math.floor(window.innerHeight * DPR);
    canvas.width = W;
    canvas.height = H;
    canvas.style.width = '100vw';
    canvas.style.height = '100vh';
    // choose grid size based on screen
    const area = window.innerWidth * window.innerHeight;
    // increase grid resolution for crisper rendering (reduce pixelation)
    const target = Math.sqrt(area / 100000);
    N = clamp(Math.floor(90 * target), 128, 384);
    alloc();
    seedBlueStream();
    if (typeof resolutionEl !== 'undefined' && resolutionEl) resolutionEl.value = N;
  }
  function resizeGrid(newN) {
    newN = clamp(newN|0, 32, 1024);
    if (newN === N) return;
    const oldN = N;
    const oldIX = (x,y)=>x + y*(oldN+2);
    const oldR = dR, oldG = dG, oldB = dB, oldU = u, oldV = v;
    N = newN;
    alloc();
    const sx = oldN / N;
    for (let j=1; j<=N; j++) {
      for (let i=1; i<=N; i++) {
        const ox = clamp(Math.floor(i*sx),1,oldN);
        const oy = clamp(Math.floor(j*sx),1,oldN);
        const src = oldIX(ox,oy);
        const id = IX(i,j);
        dR[id] = oldR[src];
        dG[id] = oldG[src];
        dB[id] = oldB[src];
        u[id] = oldU[src];
        v[id] = oldV[src];
      }
    }
    if (typeof resolutionEl !== 'undefined' && resolutionEl) resolutionEl.value = N;
  }
  function withHighRes(fn) {
    const area = window.innerWidth * window.innerHeight;
    const target = Math.sqrt(area / 100000);
    const hi = clamp(Math.floor(200 * target), 128, 384);
    const oldN = N;
    resizeGrid(hi);
    draw();
    fn(() => {
      resizeGrid(oldN);
      draw();
    });
  }
  window.addEventListener('resize', ensureCanvas);
  // UI elements
  const speedEl = document.getElementById('speed');
  const strengthEl = document.getElementById('strength');
  const sizeEl = document.getElementById('size');
  const viscEl = document.getElementById('visc');
  const diffEl = document.getElementById('diff');
  const colorSwatch = document.querySelector('#colorSelector .swatch');
  const resolutionEl = document.getElementById('resolution');
  const toolbar = document.getElementById('toolbar');
  const settingsBtn = document.getElementById('settingsBtn');
  const colorPickerPopup = document.getElementById('colorPickerPopup');
  const colorPicker = new iro.ColorPicker('#colorPickerPopup', {
    width: 180,
    color: '#00aaff',
    layout: [
      { component: iro.ui.Wheel },
      { component: iro.ui.Box }
    ]
  });
  colorPicker.on('color:change', (color) => {
    colorSwatch.style.background = color.hexString;
    pourColor = [color.rgb.r, color.rgb.g, color.rgb.b];
  });

  if (resolutionEl) {
    resolutionEl.addEventListener('input', () => {
      resizeGrid(parseInt(resolutionEl.value));
    });
  }
  document.getElementById('colorSelector').addEventListener('click', (e) => {
    e.stopPropagation();
    colorPickerPopup.style.display = colorPickerPopup.style.display === 'block' ? 'none' : 'block';
  });
  document.addEventListener('click', (e) => {
    if (!colorPickerPopup.contains(e.target) && e.target.id !== 'colorSelector') {
      colorPickerPopup.style.display = 'none';
    }
  });
  settingsBtn.addEventListener('click', () => {
    openPanel(settingsPanel);
  });

  // Dropdown elements for colour and blend tools
  const colorDropdown = document.getElementById('colorDropdown');
  const blendDropdown = document.getElementById('blendDropdown');
  // New artwork colour controls
  const newColorsEl = document.getElementById('newColors');
  const newColorInputs = document.getElementById('newColorInputs');

  // Show toolbar when the cursor is near the bottom of the screen
  document.addEventListener('mousemove', (e) => {
    if (e.clientY > window.innerHeight * 0.8) {
      toolbar.classList.add('show');
    } else {
      toolbar.classList.remove('show');
    }
  });
  // Dropdown toggling for colour and blend tool menus
  function closeDropdowns() {
    colorDropdown.classList.remove('open');
    blendDropdown.classList.remove('open');
  }
  colorDropdown.querySelector('.group-btn').addEventListener('click', (e) => {
    e.stopPropagation();
    const open = colorDropdown.classList.contains('open');
    closeDropdowns();
@@ -1081,54 +1160,58 @@ body {
    }
    // If no colors selected (fallback), generate random colours
    if (cols.length === 0) {
      for(let i=0; i<count; i++){
        const r = Math.floor(50+Math.random()*205);
        const g = Math.floor(50+Math.random()*205);
        const b = Math.floor(50+Math.random()*205);
        cols.push('#'+((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1));
      }
    }
    seedLayout(layout, cols);
    pushUndo();
    closePanel(newPanel);
  });
  // Export
  document.getElementById('exportBtn').addEventListener('click', () => {
    openPanel(exportPanel);
  });
  document.getElementById('exportDownload').addEventListener('click', () => {
    const format = document.getElementById('exportFormat').value;
    let width = parseInt(document.getElementById('exportWidth').value) || W;
    let height = parseInt(document.getElementById('exportHeight').value) || H;
    width = clamp(width, 100, 4096);
    height = clamp(height, 100, 4096);
    const quality = parseFloat(document.getElementById('exportQuality').value) || 0.92;
    withHighRes((done) => {
      exportImage(format, width, height, quality, done);
    });
  });
  document.getElementById('cameraBtn').addEventListener('click', () => {
    withHighRes((done) => {
      exportImage('jpeg', W, H, 0.92, done);
    });
  });
  // Panels
  const settingsPanel = document.getElementById('settingsPanel');
  const newPanel = document.getElementById('newPanel');
  const exportPanel = document.getElementById('exportPanel');
  document.querySelectorAll('.close-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      closePanel(e.target.closest('div'));
    });
  });
  function openPanel(panel) {
    panel.style.display = 'block';
    setTimeout(() => { panel.classList.add('open'); }, 10);
    document.addEventListener('mousedown', outsideClick);
  }
  function closePanel(panel) {
    panel.classList.remove('open');
    panel.style.display = 'none';
    document.removeEventListener('mousedown', outsideClick);
  }
  function outsideClick(e) {
    if (!settingsPanel.contains(e.target) && !newPanel.contains(e.target) && !exportPanel.contains(e.target) && !toolbar.contains(e.target)) {
      [settingsPanel, newPanel, exportPanel].forEach(p => { p.style.display='none'; p.classList.remove('open'); });
      document.removeEventListener('mousedown', outsideClick);
    }
@@ -1183,91 +1266,71 @@ body {
  }
  // Drag for panels
  document.querySelectorAll('#settingsPanel .panel-header, #newPanel .panel-header, #exportPanel .panel-header').forEach(header => {
    let offsetX=0, offsetY=0, dragging=false;
    header.addEventListener('mousedown', e => {
      dragging = true;
      const rect = header.parentElement.getBoundingClientRect();
      offsetX = e.clientX - rect.left;
      offsetY = e.clientY - rect.top;
      document.addEventListener('mousemove', drag);
      document.addEventListener('mouseup', stop);
    });
    function drag(e) {
      if (!dragging) return;
      const panel = header.parentElement;
      panel.style.left = (e.clientX - offsetX) + 'px';
      panel.style.top = (e.clientY - offsetY) + 'px';
      panel.style.transform = '';
    }
    function stop() {
      dragging = false;
      document.removeEventListener('mousemove', drag);
      document.removeEventListener('mouseup', stop);
    }
  });
  // Disable default context menu
  canvas.addEventListener('contextmenu', (e) => {
    e.preventDefault();
  });
  // Input events
  canvas.addEventListener('mousedown', (e) => {
    if (e.button === 0 || e.button === 2) {
      holding = true;
      holdButton = e.button;
      holdStart = performance.now();
      cursorX = e.offsetX * DPR;
      cursorY = e.offsetY * DPR;
      prevX = cursorX; prevY = cursorY;
      maybeTip(currentTool);
      e.preventDefault();
    }
  });
  window.addEventListener('mouseup', (e) => {
    if (holding && (e.button === holdButton)) {
      holding = false;
      pushUndo();
    }
  });
  canvas.addEventListener('mousemove', (e) => {
    const x = e.offsetX * DPR;
    const y = e.offsetY * DPR;
    if (holding) {
      prevX = cursorX;
      prevY = cursorY;
    }
    cursorX = x; cursorY = y;
  });
  canvas.addEventListener('touchstart', (e) => {
    const t = e.touches[0];
    const rect = canvas.getBoundingClientRect();
    holding = true;
    holdButton = 0;
    cursorX = (t.clientX - rect.left) * DPR;
    cursorY = (t.clientY - rect.top) * DPR;
    prevX = cursorX; prevY = cursorY;
    maybeTip(currentTool);
    e.preventDefault();
  }, {passive:false});
  canvas.addEventListener('touchmove', (e) => {
    const t = e.touches[0];
    const rect = canvas.getBoundingClientRect();
@@ -1278,70 +1341,71 @@ body {
    e.preventDefault();
  }, {passive:false});
  canvas.addEventListener('touchend', () => {
    holding = false;
    pushUndo();
  }, {passive:true});
  // Keyboard shortcuts
  window.addEventListener('keydown', (e) => {
    if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'z') {
      e.preventDefault();
      if (e.shiftKey) { redo(); } else { undo(); }
    }
    if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'y') {
      e.preventDefault();
      redo();
    }
    if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'p') {
      e.preventDefault();
      exportImage('jpeg', W, H, 0.92);
    }
    if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') {
      e.preventDefault();
      openPanel(exportPanel);
    }
  });
  function exportImage(format, width, height, quality, cb) {
    // copy canvas to offscreen at new resolution
    const off = document.createElement('canvas');
    off.width = width;
    off.height = height;
    const offCtx = off.getContext('2d');
    // draw scaled image
    offCtx.drawImage(canvas, 0, 0, width, height);
    const mime = format === 'png' ? 'image/png' :
                 format === 'jpeg' ? 'image/jpeg' : 'image/webp';
    off.toBlob((blob) => {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      const date = new Date().toISOString().replace(/[:.]/g,'-');
      a.download = 'fluid-art-' + date + '.' + format;
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(() => URL.revokeObjectURL(url), 1000);
      if (cb) cb();
    }, mime, quality);
    closePanel(exportPanel);
  }
  // Render
  let img, pixels;
  function ensureImage() {
    if (!img || img.width !== W || img.height !== H) {
      img = ctx.createImageData(W, H);
      pixels = img.data;
    }
  }
  function draw() {
    ensureImage();
    const sx = N / W;
    const sy = N / H;
    let p = 0;
    for(let y=0; y<H; y++){
      const gy = clamp((y*sy+1)|0, 1, N);
      for(let x=0; x<W; x++){
        const gx = clamp((x*sx+1)|0, 1, N);
        const id = IX(gx, gy);
        pixels[p++] = clamp(dR[id], 0, 255)|0;
        pixels[p++] = clamp(dG[id], 0, 255)|0;
        pixels[p++] = clamp(dB[id], 0, 255)|0;
        pixels[p++] = 255;
@@ -1364,29 +1428,29 @@ body {
      else if (currentTool === 'smudge') addSmudge(dt);
      else if (currentTool === 'push') addPush(dt);
      else if (currentTool === 'pinch') addPinch(dt);
      else if (currentTool === 'ripple') addRipple(dt);
    }
    // Fluid simulation
    vel_step(u, v, u0, v0, +viscEl.value, dt);
    // fade dyes slightly
    for(let i=0;i<dR0.length;i++){
      dR0[i] = dR[i] * 0.999;
      dG0[i] = dG[i] * 0.999;
      dB0[i] = dB[i] * 0.999;
    }
    dens_step(dR, dG, dB, dR0, dG0, dB0, +diffEl.value, dt);
    draw();
    requestAnimationFrame(step);
  }
  ensureCanvas();
  requestAnimationFrame(step);
})();
</script>

  <!-- Welcome overlay -->
  <div id="welcomeOverlay">
    <div class="panel-header"><h3>Welcome to Bucket</h3><button id="welcomeClose">&times;</button></div>
    <p>Hover near the bottom of the page to reveal the toolbar. Use the settings button to adjust your brush and fluid settings. Right‑click now spins the blender in the opposite direction. Have fun creating your art!</p>
  </div>
</body>
</html>
