<section class="pi-section" aria-labelledby="pi-h2" role="region">
  <div class="pi-wrap">
    <header class="pi-header pi-fade">
      <div class="pi-eyebrow">Contact</div>
      <h2 id="pi-h2">Get in touch ‚Äî we <span class="pi-verb" aria-live="polite">anticipate</span>.</h2>
      <p class="pi-lede">Playfully intelligent, quietly precise. We <span class="pi-verb" aria-hidden="true">adapt</span> when you do.</p>
    </header>

    <!-- Background grid (spotlight affects only this layer) -->
    <div class="pi-grid" aria-hidden="true"></div>

    <div class="pi-cards pi-fade">
      <!-- EMAIL -->
      <article class="pi-card" role="group" tabindex="0"
        data-type="email"
        data-obf="bW9jLm5pdmFkbnNhbmJAZm9ydm5pcy5rdWJfOjpwZQ=="
        data-pep="pe"
        aria-label="Email card">
        <div class="pi-label">
          <span class="pi-chip" aria-hidden="true">‚úâÔ∏è</span>
          <h4>Email</h4>
        </div>
        <p class="pi-kbd">Long-hover or press-and-hold to reveal.</p>
        <div class="pi-detail" aria-live="polite" aria-hidden="true"></div>
        <div class="pi-hold">
          <button class="pi-btn" type="button" aria-label="Press and hold to reveal email">
            Reveal contact
          </button>
          <span class="pi-progress" aria-hidden="true">Hold to 100%</span>
        </div>
      </article>

      <!-- PHONE -->
      <article class="pi-card" role="group" tabindex="0"
        data-type="phone"
        data-obf="NTE2MjEzNzY2Xzo6cGU="
        data-pep="pe"
        aria-label="Phone card">
        <div class="pi-label">
          <span class="pi-chip" aria-hidden="true">üìû</span>
          <h4>Phone</h4>
        </div>
        <p class="pi-kbd">Hold Space/Enter or press-and-hold.</p>
        <div class="pi-detail" aria-live="polite" aria-hidden="true"></div>
        <div class="pi-hold">
          <button class="pi-btn" type="button" aria-label="Press and hold to reveal phone">
            Reveal contact
          </button>
          <span class="pi-progress" aria-hidden="true">Hold to 100%</span>
        </div>
      </article>

      <!-- LINKEDIN -->
      <article class="pi-card" role="group" tabindex="0"
        data-type="link"
        data-obf="L3B1YmxpYy1yYXZpZC1uYWRpdm5hcy1uZWIvbmkvaW4vLm5pYWQtbmVkbnliL25pL3d3dy86OnBl"
        data-pep="pe"
        aria-label="LinkedIn card">
        <div class="pi-label">
          <span class="pi-chip" aria-hidden="true">üîó</span>
          <h4>LinkedIn</h4>
        </div>
        <p class="pi-kbd">Press-and-hold to reveal the profile.</p>
        <div class="pi-detail" aria-live="polite" aria-hidden="true"></div>
        <div class="pi-hold">
          <button class="pi-btn" type="button" aria-label="Press and hold to reveal LinkedIn">
            Reveal contact
          </button>
          <span class="pi-progress" aria-hidden="true">Hold to 100%</span>
        </div>
      </article>
    </div>

    <!-- CTA row -->
    <div class="pi-cta pi-fade" role="form" aria-label="Quick intent">
      <div class="pi-cmd">
        <input type="text" inputmode="text" autocomplete="off" spellcheck="false" aria-label="Command"
               placeholder="Type an intent‚Ä¶ e.g., ‚Äòscope a project‚Äô">
        <button class="pi-chipbtn" type="button">estimate</button>
        <button class="pi-chipbtn" type="button">timeline</button>
        <button class="pi-chipbtn" type="button">portfolio</button>
      </div>
    </div>
  </div>

  <script>
  (() => {
    const root = document.currentScript.closest('.pi-section');
    const prefersReduce = matchMedia('(prefers-reduced-motion: reduce)').matches;
    const CARDS = [...root.querySelectorAll('.pi-card')];
    const GRID = root.querySelector('.pi-grid');
    let raf = 0;

    // Intersection: gentle entrance
    const io = new IntersectionObserver(([e]) => {
      if (e.isIntersecting) { root.classList.add('is-in'); io.disconnect(); }
    }, { threshold: 0.2 });
    io.observe(root);

    // Cognitive Spotlight: update --x/--y relative to grid rect
    const setXY = (x, y) => {
      if (!GRID) return;
      const r = GRID.getBoundingClientRect();
      const px = ((x - r.left) / r.width) * 100;
      const py = ((y - r.top) / r.height) * 100;
      root.style.setProperty('--x', Math.max(0, Math.min(100, px)) + '%');
      root.style.setProperty('--y', Math.max(0, Math.min(100, py)) + '%');
    };
    const onMove = (ev) => {
      if (prefersReduce) return;
      cancelAnimationFrame(raf);
      raf = requestAnimationFrame(() => setXY(ev.clientX, ev.clientY));
    };
    root.addEventListener('pointermove', onMove, { passive: true });
    root.addEventListener('mouseleave', () => { if (!prefersReduce) { root.style.setProperty('--x','50%'); root.style.setProperty('--y','50%'); } });

    // Focus moves spotlight to card center
    CARDS.forEach(card => {
      card.addEventListener('focus', () => {
        const r = card.getBoundingClientRect();
        setXY(r.left + r.width/2, r.top + r.height/2);
      });
    });

    // Phrase rotator (Thinking Micro-Copy)
    const verbs = ['anticipate','adapt','explain','compare'];
    if (!prefersReduce) {
      const nodes = root.querySelectorAll('.pi-verb');
      let i = 0;
      setInterval(() => {
        i = (i + 1) % verbs.length;
        nodes.forEach(n => n.textContent = verbs[i]);
      }, 2400);
    }

    // Contact Protection: press-and-hold / long-hover
    const HOLD_MS = 900, MOVE_PX = 12;
    const decode = (b64, pep) => {
      try {
        const raw = atob(b64);
        const [rev, got] = raw.split('::');
        if (got !== pep) return null;
        return rev.split('').reverse().join('');
      } catch { return null; }
    };
    // Pre-obfuscate values (base64 of reversed + "::pep")
    // (Strings are not present in plain text in the DOM.)

    const startHold = (ctx) => {
      if (ctx.done) return;
      ctx.start = performance.now();
      ctx.frame = requestAnimationFrame(function tick(t){
        const p = Math.min(1, (t - ctx.start) / HOLD_MS);
        ctx.card.querySelector('.pi-btn').style.setProperty('--p', p);
        if (ctx.cancelled) return;
        if (p >= 1) { reveal(ctx.card); return; }
        ctx.frame = requestAnimationFrame(tick);
      });
    };
    const cancelHold = (ctx) => {
      ctx.cancelled = true;
      cancelAnimationFrame(ctx.frame);
      ctx.card.querySelector('.pi-btn').style.setProperty('--p', 0);
    };

    const reveal = (card) => {
      if (card.dataset.revealed) return;
      card.dataset.revealed = "true";
      const type = card.dataset.type;
      const val = decode(card.dataset.obf, card.dataset.pep);
      const live = card.querySelector('.pi-detail');
      live.setAttribute('aria-hidden','false');
      live.style.contentVisibility = 'visible';
      let a;
      if (type === 'email') {
        a = document.createElement('a'); a.href = 'mailto:' + val; a.textContent = val;
      } else if (type === 'phone') {
        a = document.createElement('a'); a.href = 'tel:' + val; a.textContent = val.replace(/(\d{3})(\d{3})(\d{3,})/,'$1 $2 $3');
      } else {
        a = document.createElement('a'); a.href = 'https://' + val; a.target = '_blank'; a.rel = 'noopener'; a.textContent = 'LinkedIn Profile';
      }
      live.replaceChildren(a);
    };

    CARDS.forEach(card => {
      const btn = card.querySelector('.pi-btn');
      const ctx = { card, start:0, frame:0, cancelled:false, done:false };

      // Pointer long-hover (requires real movement within threshold)
      let entered = false, startX=0, startY=0;
      card.addEventListener('pointerenter', (e)=>{ entered = true; startX=e.clientX; startY=e.clientY; ctx.cancelled=false; });
      card.addEventListener('pointermove', (e)=>{
        if (!entered || ctx.done) return;
        const dx=e.clientX-startX, dy=e.clientY-startY;
        const dist=Math.hypot(dx,dy);
        if (dist>MOVE_PX) { startX=e.clientX; startY=e.clientY; cancelHold(ctx); return; }
        if (!ctx.frame) startHold(ctx);
      }, {passive:true});
      card.addEventListener('pointerleave', ()=>{ entered=false; cancelHold(ctx); });

      // Press-and-hold on button (mouse/touch/pen)
      const down = (e)=>{ e.preventDefault(); ctx.cancelled=false; startHold(ctx); };
      const up = ()=> cancelHold(ctx);
      btn.addEventListener('pointerdown', down);
      ['pointerup','pointercancel','pointerleave'].forEach(ev=>btn.addEventListener(ev, up));

      // Keyboard: hold Space/Enter
      const keyDown = (e)=>{
        if (e.repeat) return;
        if (e.code==='Space' || e.code==='Enter'){ e.preventDefault(); ctx.cancelled=false; startHold(ctx); }
      };
      const keyUp = (e)=>{ if (e.code==='Space' || e.code==='Enter') cancelHold(ctx); };
      card.addEventListener('keydown', keyDown);
      card.addEventListener('keyup', keyUp);

      // Escape cancels
      card.addEventListener('keydown', (e)=>{ if (e.key==='Escape') cancelHold(ctx); });
    });

    // Helper: seed obfuscated values if author forgot (safety)
    // (Here we rely on pre-filled data-obf; nothing else to do.)

  })();
  </script>
</section>