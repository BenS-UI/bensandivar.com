<!-- homesplits/gallery.html -->
<section class="photo-grid" id="gallery" data-split="gallery">
  <div class="page-header">
    <h2>Photo Gallery</h2>
    <p>A collection of snapshots and moments.</p>
  </div>

  <div class="gallery-masonry" id="gallery-container">
    <!-- Gallery items populated with available 'ben' images from the assets folder -->
    <div class="grid-item" data-tilt><img src="assets/ben%20(0).png" alt="Ben 0" loading="lazy" draggable="false" oncontextmenu="return false;"></div>
    <div class="grid-item" data-tilt><img src="assets/ben%20(13).png" alt="Ben 13" loading="lazy" draggable="false" oncontextmenu="return false;"></div>
    <div class="grid-item" data-tilt><img src="assets/ben%20(1).png" alt="Ben 1 PNG" loading="lazy" draggable="false" oncontextmenu="return false;"></div>
    <div class="grid-item" data-tilt><img src="assets/ben%20(2).png" alt="Ben 2 PNG" loading="lazy" draggable="false" oncontextmenu="return false;"></div>
    <div class="grid-item" data-tilt><img src="assets/ben%20(3).jpg" alt="Ben 3 JPG" loading="lazy" draggable="false" oncontextmenu="return false;"></div>
    <div class="grid-item" data-tilt><img src="assets/ben%20(3).png" alt="Ben 3 PNG" loading="lazy" draggable="false" oncontextmenu="return false;"></div>
    <div class="grid-item" data-tilt><img src="assets/ben%20(4).png" alt="Ben 4" loading="lazy" draggable="false" oncontextmenu="return false;"></div>
    <div class="grid-item" data-tilt><img src="assets/ben%20(5).png" alt="Ben 5" loading="lazy" draggable="false" oncontextmenu="return false;"></div>
    <div class="grid-item" data-tilt><img src="assets/ben%20(6).png" alt="Ben 6" loading="lazy" draggable="false" oncontextmenu="return false;"></div>
    <div class="grid-item" data-tilt><img src="assets/ben%20(7).png" alt="Ben 7" loading="lazy" draggable="false" oncontextmenu="return false;"></div>
    <div class="grid-item" data-tilt><img src="assets/ben%20(8).png" alt="Ben 8" loading="lazy" draggable="false" oncontextmenu="return false;"></div>
    <div class="grid-item" data-tilt><img src="assets/ben%20(10).png" alt="Ben 10" loading="lazy" draggable="false" oncontextmenu="return false;"></div>
    <div class="grid-item" data-tilt><img src="assets/ben.png" alt="Ben" loading="lazy" draggable="false" oncontextmenu="return false;"></div>
    <div class="grid-item" data-tilt><img src="assets/ben%20(4).jpg" alt="Ben 4" loading="lazy" draggable="false" oncontextmenu="return false;"></div>
    <div class="grid-item" data-tilt><img src="assets/ben%20(9).png" alt="Ben 9" loading="lazy" draggable="false" oncontextmenu="return false;"></div>
    <div class="grid-item" data-tilt><img src="assets/ben.jpg" alt="Ben" loading="lazy" draggable="false" oncontextmenu="return false;"></div>
    <div class="grid-item" data-tilt><img src="assets/ben%20(11).png" alt="Ben 11" loading="lazy" draggable="false" oncontextmenu="return false;"></div>
  </div>

  <script>
    /* Tilt (invert + slower) */
    (function () {
      if (!window.VanillaTilt) return;
      const items = document.querySelectorAll('#gallery .grid-item[data-tilt]');
      if (items.length) {
        window.VanillaTilt.init(items, {
          max: 8,
          speed: 800,
          glare: true,
          "max-glare": 0.12,
          reverse: true
        });
      }
    })();

    /* Neon LED backlight behind each image */
    (function () {
      const LERP = 0.12;        // smoothing
      const SAT_MULT = 5.0;     // ~500% saturation
      const BRIGHT_BUMP = 0.12; // a bit brighter
      const MIN_BRIGHT = 0.38;  // ignore very dark picks
      const WARM_FALLBACK = { h: 0.12, s: 1.0, l: 0.60 }; // ~incandescent

      function hslToRgb(h,s,l){
        let r,g,b;
        if (s===0){ r=g=b=l; }
        else{
          const hue2rgb=(p,q,t)=>{
            if(t<0) t+=1; if(t>1) t-=1;
            if(t<1/6) return p+(q-p)*6*t;
            if(t<1/2) return q;
            if(t<2/3) return p+(q-p)*(2/3 - t)*6;
            return p;
          };
          const q=l<0.5 ? l*(1+s) : l + s - l*s;
          const p=2*l-q;
          r=hue2rgb(p,q,h+1/3); g=hue2rgb(p,q,h); b=hue2rgb(p,q,h-1/3);
        }
        return [Math.round(r*255),Math.round(g*255),Math.round(b*255)];
      }
      function rgbToHsl(r,g,b){
        r/=255; g/=255; b/=255;
        const max=Math.max(r,g,b), min=Math.min(r,g,b);
        let h=0,s=0,l=(max+min)/2;
        if(max!==min){
          const d=max-min;
          s=l>0.5? d/(2-max-min) : d/(max+min);
          switch(max){
            case r: h=(g-b)/d+(g<b?6:0); break;
            case g: h=(b-r)/d+2; break;
            default: h=(r-g)/d+4;
          }
          h/=6;
        }
        return [h,s,l];
      }
      function luminance(r,g,b){
        // simple perceived brightness 0..1
        return (0.2126*(r/255) + 0.7152*(g/255) + 0.0722*(b/255));
      }

      document.querySelectorAll('#gallery .grid-item').forEach(card => {
        const img = card.querySelector('img');

        // canvas for sampling
        const cvs = document.createElement('canvas');
        const ctx = cvs.getContext('2d', { willReadFrequently: true });
        let ready = false;

        function paint() {
          if (!img.naturalWidth || !img.naturalHeight) return;
          cvs.width = img.naturalWidth;
          cvs.height = img.naturalHeight;
          try {
            ctx.clearRect(0,0,cvs.width,cvs.height);
            ctx.drawImage(img,0,0,cvs.width,cvs.height);
            ready = true;
          } catch(e){ ready = false; }
        }
        if (img.complete) paint();
        else img.addEventListener('load', paint);

        // smooth state
        let cx=0.5, cy=0.5, tx=0.5, ty=0.5;
        let cr=255, cg=200, cb=120; // warm-ish default
        let tr=255, tg=200, tb=120;
        let lastBright = { r: cr, g: cg, b: cb };

        card.addEventListener('mousemove', e => {
          const rect = img.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          tx = x / rect.width;
          ty = y / rect.height;

          if (ready) {
            const ix = Math.max(0, Math.min(cvs.width-1, Math.floor(x * (cvs.width / rect.width))));
            const iy = Math.max(0, Math.min(cvs.height-1, Math.floor(y * (cvs.height / rect.height))));
            const d = ctx.getImageData(ix, iy, 1, 1).data;
            // boost to neon
            let [h,s,l] = rgbToHsl(d[0], d[1], d[2]);
            s = Math.min(1, s * SAT_MULT);
            l = Math.min(1, Math.max(0, l + BRIGHT_BUMP));
            const [nr, ng, nb] = hslToRgb(h,s,l);

            // avoid dull/dark picks
            const bright = luminance(nr,ng,nb);
            if (bright >= MIN_BRIGHT) {
              tr = nr; tg = ng; tb = nb;
              lastBright = { r: nr, g: ng, b: nb };
            } else {
              // stick to last bright, or warm fallback
              if (lastBright) { tr = lastBright.r; tg = lastBright.g; tb = lastBright.b; }
              else {
                const [wr,wg,wb] = hslToRgb(WARM_FALLBACK.h, WARM_FALLBACK.s, WARM_FALLBACK.l);
                tr = wr; tg = wg; tb = wb;
              }
            }
          }

          card.style.setProperty('--backlight-o', '1');
        });

        card.addEventListener('mouseleave', () => {
          card.style.setProperty('--backlight-o', '0');
        });

        function tick(){
          cx += (tx - cx) * LERP;
          cy += (ty - cy) * LERP;
          cr += (tr - cr) * LERP;
          cg += (tg - cg) * LERP;
          cb += (tb - cb) * LERP;

          card.style.setProperty('--bx', (cx * 100) + '%');
          card.style.setProperty('--by', (cy * 100) + '%');
          card.style.setProperty('--r', Math.round(cr));
          card.style.setProperty('--g', Math.round(cg));
          card.style.setProperty('--b', Math.round(cb));
          requestAnimationFrame(tick);
        }
        requestAnimationFrame(tick);
      });
    })();
  </script>
</section>
